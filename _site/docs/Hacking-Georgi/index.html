<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Hacking Georgi - docs.gboards.ca</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Hacking Georgi | docs.gboards.ca</title><meta name="generator" content="Jekyll v3.8.6" /><meta property="og:title" content="Hacking Georgi" /><meta property="og:locale" content="en_US" /><meta name="description" content="Docs and build guides for g Heavy Industries products" /><meta property="og:description" content="Docs and build guides for g Heavy Industries products" /><link rel="canonical" href="http://localhost:4000/docs/Hacking-Georgi/" /><meta property="og:url" content="http://localhost:4000/docs/Hacking-Georgi/" /><meta property="og:site_name" content="docs.gboards.ca" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Hacking Georgi","description":"Docs and build guides for g Heavy Industries products","url":"http://localhost:4000/docs/Hacking-Georgi/","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> docs.gboards.ca </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="http://localhost:4000/" class="navigation-list-link">Home</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Gergo-Setup/" class="navigation-list-link">Gergo Setup</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Unboxing-Georgi/" class="navigation-list-link">Unboxing Georgi</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Configuring-Georgi/" class="navigation-list-link">Configuring Georgi</a><li class="navigation-list-item active"><a href="http://localhost:4000/docs/Hacking-Georgi/" class="navigation-list-link active">Hacking Georgi</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Georgi-Firmwares/" class="navigation-list-link">Georgi Firmwares</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Ginny/" class="navigation-list-link">Ginny and ASETNIOP</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Meet-Butter-Stick/" class="navigation-list-link">Meeting Butterstick</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Building%20ButterStick/" class="navigation-list-link">Building A Butterstick</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/Component-References/" class="navigation-list-link">Reference/Assembly Diagrams, Proto Firmware</a><li class="navigation-list-item"> <a href="http://combos.gboards.ca/" class="navigation-list-link"><b>Combos/Chords Docs</b></a></ul></nav></div><footer class="site-footer"></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="//github.com/germ">GitHub</a></ul></div><div class="page"><div id="main-content" class="page-content" role="main"><h1 id="hacking-georgi"> <a href="#hacking-georgi" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Hacking Georgi</h1><p>Alright, so you’ve finally found something that you can’t do from the default firmware. A bit of heads up here, you’re going to need to know some QMK internals so <a href="https://beta.docs.qmk.fm/for-a-deeper-understanding/understanding_qmk">give this excellent guide a read</a> and come on back.</p><h3 id="how-georgi-do"> <a href="#how-georgi-do" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> How Georgi Do</h3><p>Pop open sten.h so you have a reference to use. Everything that Georgi does is independent of QMK proper and happens in here and processQwerty() in the keymap. The current chord state is held in a cChord. We hook <code class="highlighter-rouge">process_steno_user</code> to update this chord as keys come in and hook <code class="highlighter-rouge">send_steno_chord_user</code> to process everything once the keys are up. If none of our actions match we return true and continue processing (QMK will then send the steno codes).</p><h3 id="cchord"> <a href="#cchord" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> cChord</h3><p>This is just a bigass bitfield that is set in <code class="highlighter-rouge">process_steno_user</code> we can add keys to this easily but there are a total maximum of 32 possible states we can jam in there. To define your own codes, append an entry to the ORDER enum, make a nice pretty #define for it, and start adding entries to your keymap.</p><h3 id="key-repeat"> <a href="#key-repeat" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Key Repeat</h3><p>Once the first button press comes in we start a timer and keep checking it in <code class="highlighter-rouge">matrix_scan_user</code>, if this timer expires we send the lookup the current chords and reset the timer. You can adjust this timer by changing the REP_DELAY #define in sten.h.</p><h3 id="click_mouse"> <a href="#click_mouse" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> CLICK_MOUSE()</h3><p>Mousekeys are done using the repeat mechanism, if a mousepress is sent it will remain in a down state until the chord is sent. The button that is clicked is selected from <a href="https://github.com/qmk/qmk_firmware/blob/master/docs/keycodes.md#mouse-keys">this list here</a>. If the chord is too short to register a repeat a single click is generated.</p><h3 id="send"> <a href="#send" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> SEND()</h3><p>Send is just a light wrapper around register_code(), this is needed to buffer if we are in command mode. Just like register_code() Quantum Codes cannot be used here. You need to use SEND otherwise command mode won’t work!</p><h3 id="set_sticky"> <a href="#set_sticky" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> SET_STICKY()</h3><p>When this chord is matched a sticky bit is set in cChord. The usual way you would use this is with the codes RES1 and RES2. When the sticky bit is set cChord will process all incoming chords with this. Use cases are similar to changing the default layer in QMK. Using sticky bits you could toggle between QWERTY and WORKMAN and whatnot. To clear any stickybits that have been set, pass 0 when calling it.</p><h3 id="switch_layer"> <a href="#switch_layer" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> SWITCH_LAYER()</h3><p>This is a helper that jumps to the specified QMK layer, if it exists. Returning to the default layer is left as a excercise to the reader.</p><h3 id="command-mode"> <a href="#command-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Command mode</h3><p>The buffer can store up to 20 different keypresses (if you somehow need more, update <strong>REP_DELAY</strong>). The way we do this is by wrapping <strong>register_code()</strong> with send and replaying the buffer, depressing every key in the sequence before key up. This only applies to wrapped codes so things like mouse clicks and custom code won’t be in there.</p><h3 id="qwerty-fallback"> <a href="#qwerty-fallback" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> QWERTY Fallback</h3><p>proessFakeSteno() simply maps chords to NKRO Plover as a fallback mode. Ideally we would have a datastructure for various dictionaries but switching the called lookup table seems to be fine. This is a young project, submit a PR.</p><h3 id="adding-functionality"> <a href="#adding-functionality" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Adding functionality</h3><p>All of the logic happens in <strong>process_steno_chord_user</strong>, this should be your main place to add/augment functionality. In here you can preprocess chords before passing them off for handling, enable toggles, disable features, etc. You need to remember that just like in any dictionary, there is a order that everything is evaluated in, so be careful.</p><p>Two exit points are provided to jump to, <strong>out</strong> which halts further processing and cleans up, and <strong>steno</strong> which will clean up and pass off the chords to Plover. Local gotos are okay, get at me.</p><h3 id="other-qmk-jazz"> <a href="#other-qmk-jazz" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Other QMK jazz</h3><p>There’s a ton of stuff that can be leveraged here. Take a look through the tmk/common folder for some ideas and weird whacky keyboards you see around. This is a computer, make it do weird shit! If you need a hand reach out, I’ll warn you I suck at steno though.</p><hr><footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0">A <a href="https://www.gboards.ca/"> g Heavy Industries</a> project. 2020-</p></footer></div></div></div></div>
